---
title: "SVCE"
author: "ZoomRx"
date: "22/08/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(tidyverse)
library(plotly)
library(DBI)
```


# Which companies use R
<br/>
<img src="www/facebook.png" alt="drawing" width = "60px" height = "60px"/>  **For behavior analysis related to status updates and profile pictures.**
<br>
<img src="www/google.jpg" alt="drawing" width = "60px" height = "60px"/>  **For advertising effectiveness and economic forecasting.**
<br>
<img src="www/microsoft.jpg" alt="drawing" width = "60px" height = "60px"/>  **Acquired Revolution R company and use it for a various purposes.**
<br>
<img src="www/twitter.png" alt="drawing" width = "60px" height = "60px"/>  **For data visualization and semantic clustering.**
<br>
<img src="www/uber.jpg" alt="drawing" width = "60px" height = "60px"/>  **For statistical analysis.**
<br>
<img src="www/airbnb.jpg" alt="drawing" width = "60px" height = "60px"/>  **Scale data science.**
<br>
<img src="www/zoomrx.png" alt="drawing" width = "60px" height = "60px"/>  **For data curation, analysis and visualisation.**
<br>
And many more...

# Why use R, Even python can do all this stuff

Think of R like a cat!
<br>
And  Python like dog!
<br>
Both are great pets to have, Some people like one over the other. But at the end of the day both are amazing
<br>
The problem starts when someone looks at R and expects it to be a dog
<br>
**"You're dog is broken!"**
<br>
R has some strange parts, but it compenstates with some great parts. They are not just good, but great
<br>
Some parts of R are better than python and some parts of python are better than R.
<br>

![](www/belief_vs_reality.jpg)

![](www/ds_workflow.png)

# Acquiring the data

Data can be acquired from many sources into R.
R supports data formats like csv, xlsx, spss, sas or any remote database like MySQL, SQLite, PostgreSQL, MonetDB, etc

The most used methods are to read data from a csv, xlxs or txt file or connecting to MySQL or SQLite data base
<br>
<img src="www/readr.png" alt="drawing" width = "60px" height = "60px"/>  **Used for obtaining rectangular data into R like "csv", "tsv", and "fwf"**
<br>
<img src="www/readxl.png" alt="drawing" width = "60px" height = "60px"/>  **Used to import excel files into R**
<br>
<img src="www/sparklyr.png" alt="drawing" width = "60px" height = "60px"/>  **R interface to Apache Spark to work with big data**
<br>
<img src="www/googledrive.png" alt="drawing" width = "60px" height = "60px"/>  **Manage Google Drive files from R.**
<br>
<img src="www/googlesheets.png" alt="drawing" width = "60px" height = "60px"/>  **Interact with Google Sheets from R.**
<br>
<img src="www/rvest.png" alt="drawing" width = "60px" height = "60px"/>  **This package is wrapped around the 'xml2' and 'httr' packages to make it easy to download and manipulate**
<br>

### Reading local data

We can read a .csv data using the base **read.csv()** function or using **read_csv()** function from the **readr** package


```{r}
data <- read.csv("datasets/adult_data.csv")
names(data) <- c("age", "workclass", "fnlwgt", "education", "education_num", "marital_status", "occupation", "relationship", "race", "gender", "capital_gain", "capital_loss", "hours_per_week", "native_country", "predictive_variable")
head(data)
```

In order to obtain data from remote database like **SQLLite**
First we need to establish a connection to the database
```{r}
con <- dbConnect(RSQLite::SQLite(), dbname = ":memory:")
```
```{r echo = FALSE}
dbWriteTable(con, "mtcars", mtcars, overwrite = TRUE)
dbWriteTable(con, "iris", iris, overwrite = TRUE)
```
Then we can use this connection object to access and edit the database
```{r}
dbListTables(con)
mtcarsData <- dbReadTable(con, "mtcars")
str(mtcarsData)
dbDisconnect(con)
```

# Cleaning the data

In the real world the data is not always "clean".
There are many ways to define clean.
Common things to look out for:

* Look out for **NULL** or **NA** values
* Check if there are **duplicates**
* Verify the **data type** for every column/feature

<br>
<img src="www/dplyr.png" alt="drawing" width = "60px" height = "60px"/>  **dplyr is one of the most used package for data wrangling in R**
<br>
<img src="www/tidyr.png" alt="drawing" width = "60px" height = "60px"/>  **Also a very popular package for data wrangling**
<br>
<img src="www/stringr.jpg" alt="drawing" width = "60px" height = "60px"/>  **Used for string manupulation**
<br>
<img src="www/lubridate.jpg" alt="drawing" width = "60px" height = "60px"/>  **Used to work with dates data**
<br>
<img src="www/hms.png" alt="drawing" width = "60px" height = "60px"/>  **Used to work with time data**
<br>



# Understanding the data

### **Understand every column of the data first**

#### Numerical data fields
**Age**
```{r}
ggplot(data, aes(x = data$age)) + geom_bar()
```

**Hours worked per week**
```{r}
ggplot(data, aes(x = data$hours_per_week)) + geom_histogram(binwidth=10)
```

### Categorical data fields

**Marital Status**
```{r}
data_marital_status <- data %>% group_by(marital_status) %>% summarise(count = n())
ggplotly(ggplot(data_marital_status, aes(x = reorder(marital_status, count), y = count)) + geom_col() + coord_flip())
ggplot(data_marital_status, aes(x = "", y = count, fill = reorder(marital_status, - count)))+
	geom_bar(width = 1, stat = "identity") +
	coord_polar("y", start=0)
```

**Education**
```{r}
ggplotly(ggplot(data %>% group_by(education) %>% summarise(count = n()), aes(x = reorder(education, count), y = count)) + geom_col() + coord_flip())
```
**Occupation**
```{r}
ggplotly(ggplot(data %>% group_by(occupation) %>% summarise(count = n()), aes(x = reorder(occupation, count), y = count)) + geom_col() + coord_flip())
```
**Relationship**
```{r}
ggplotly(ggplot(data %>% group_by(relationship) %>% summarise(count = n()), aes(x = reorder(relationship, count), y = count)) + geom_col() + coord_flip())
```
**Race**
```{r}
ggplotly(ggplot(data %>% group_by(race) %>% summarise(count = n()), aes(x = reorder(race, count), y = count)) + geom_col() + coord_flip())
```
**Gender**
```{r}
ggplotly(ggplot(data %>% group_by(gender) %>% summarise(count = n()), aes(x = reorder(gender, count), y = count)) + geom_col() + coord_flip())
```
**Native Country**
```{r}
ggplotly(ggplot(data %>% group_by(native_country) %>% summarise(count = n()), aes(x = reorder(native_country, count), y = count)) + geom_col() + coord_flip())
```

### **Now try to make hypothesis and test them**

## Hypothesis 1

People who study more make more money

```{r}
data$is_rich <- if_else(data$predictive_variable == "<=50K", 0, 1)
education_summary <- data %>% group_by(education) %>% summarise(number_of_rich_people = sum(is_rich), number_of_poor_people = n() - number_of_rich_people, total_people = n())
education_summary
print(unique(data$predictive_variable))
print(unique(as.character(data$predictive_variable)))

salary <- unique(as.character(data$predictive_variable))
str_sub(salary, 2, str_length(salary))
gsub(" ", "", salary)
trimws(salary)
salary

library(microbenchmark)

microbenchmark(str_sub(salary, 2, str_length(salary)), gsub(" ", "", salary), trimws(salary))
salary <- str_sub(salary, 2, str_length(salary))
salary

data$predictive_variable <- str_sub(data$predictive_variable, 2, str_length(data$predictive_variable))

data$is_rich <- if_else(data$predictive_variable == "<=50K", 0, 1)
education_summary <- data %>% group_by(education) %>% summarise(number_of_rich_people = sum(is_rich), number_of_poor_people = n() - number_of_rich_people, total_people = n())
education_summary

education_data <- distinct(data %>% select(education, education_num)) %>% arrange(education_num)
education_data

data$is_rich <- if_else(data$predictive_variable == "<=50K", 0, 1)
education_summary <- data %>%
	group_by(education, education_num) %>%
	summarise(percentage_of_rich_people = sum(is_rich) / n() * 100) %>%
	arrange(education_num)
education_summary
ggplotly(ggplot(education_summary, aes(x = reorder(education, education_num), y = percentage_of_rich_people)) + geom_bar(stat = "identity") + coord_flip())
ggplotly(ggplot(education_summary, aes(x = education_num, y = percentage_of_rich_people, color = education)) + geom_point())
```

## Hypothesis 2

Let's just analyze which type of occupation makes more money

```{r}
occupation_summary <- data %>%
	group_by(occupation) %>%
	summarise(percentage_of_rich_people = sum(is_rich) / n() * 100) %>%
	arrange(percentage_of_rich_people)
occupation_summary
ggplotly(ggplot(occupation_summary, aes(x = reorder(occupation, percentage_of_rich_people), y = percentage_of_rich_people)) + geom_bar(stat = "identity") + coord_flip())
```

## Hypothesis 3

People who work more make more money

```{r}
ggplot(data, aes(x = hours_per_week, fill = predictive_variable)) + geom_histogram(binwidth = 10)
```

## Hypothesis 4

Men make more money than Women?

```{r}
ggplot(data, aes(x = gender, fill = predictive_variable)) + geom_bar(stat = "count")
gender_summary <- data %>%
	
```


## Hypothesis 5

```{r}

```


## Hypothesis 6

```{r}

```